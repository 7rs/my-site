---
import { Frontmatter } from "@lib/metagg";
import { getFont } from "@lib/font";

import BaseLayout from "@layouts/BaseLayout.astro";
import Header from "@layouts/Header.astro";
import PostHeader from "@layouts-components/blog/PostHeader.astro";
import Sidebar from "@layouts-components/blog/Sidebar.astro";
import PostFooter from "@components/layouts/blog/PostFooter.astro";

export interface Props {
  frontmatter: { [key: string]: any };
  headings: { depth: number; slug: string; text: string }[];
}
const { frontmatter, headings } = Astro.props;

const prasedFrontmatter = Frontmatter.parse(frontmatter);
---

<BaseLayout
  frontmatter={prasedFrontmatter}
  className="markdown"
  resources={{
    fonts: [
      getFont("Fira Sans", [{}, { weight: 700 }, { typefaces: 1 }, { weight: 700, typefaces: 1 }]),
      getFont("Fira Code"),
    ],
  }}
>
  <Header />
  <main>
    <PostHeader frontmatter={prasedFrontmatter} />
    <section main-content data-pagefind-body={prasedFrontmatter.published ? "" : undefined}>
      <slot />
    </section>
    <PostFooter lang={prasedFrontmatter.lang} />
  </main>
  <Sidebar frontmatter={prasedFrontmatter} headings={headings} />
</BaseLayout>

<style lang="stylus">
  @import "../styles/api.styl"

  body.markdown
    background var(--background)
    z-index 0
    position relative
    box-sizing border-box

    height 100vh
    width 100%
    max-height 100vh
    max-width widths.largest

    display grid
    grid-template-areas "header" \
                        "content"
    @media screen and (min-width widths.large)
      grid-template-areas "header  header " \
                          "content sidebar"
      margin auto
      max-height 100vh
      grid-template-rows 1fr calc(100vh - 1fr)
      grid-template-columns 3fr 1fr

    header[main-header]
      grid-area header

    main
      grid-area content
      max-width 900px

    aside
      grid-area sidebar
      @media screen and (min-width widths.largest)
        max-width 300px

    aside, main
      overflow clip auto
      box-sizing border-box
      padding 3rem 1.5rem
      width 100%
      height 100%
      scrollbar()

      padding 2rem 1rem
      @media screen and (min-width widths.largest)
        padding 3rem 1.5rem
</style>
