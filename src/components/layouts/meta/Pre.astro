---
import { createGoogleFontURL } from "@lib/font";
import { PreResources } from "@lib/meta";

import PreConnect from "@layouts-components/meta/PreConnect.astro";

export interface Props extends PreResources {
  useCloudflareFonts?: boolean;
}

const { fonts = [], images, light, dark, useCloudflareFonts = true } = Astro.props;
---

{
  /*
    Fonts won't be downloaded from Google if Cloudflare Fonts is enabled.

    Write `PreConnect` if you immediately use the following:
    - https://giscus.app/
    - https://api.iconify.design/
  */
  (import.meta.env.DEV || !useCloudflareFonts) && (
    <>
      <PreConnect href="https://fonts.googleapis.com/" crossorigin="" />
      <PreConnect href="https://fonts.gstatic.com/" crossorigin="" />
    </>
  )
}
<link rel="stylesheet" href={createGoogleFontURL(fonts)} as="style" crossorigin="" />

{
  light && (
    <link
      rel="prefetch"
      fetchpriority="high"
      as="image"
      type={`image/${light.format}`}
      href={light.src}
      media="(prefers-color-scheme: light)"
    />
  )
}

{
  dark && (
    <link
      rel="prefetch"
      fetchpriority="high"
      as="image"
      type={`image/${dark.format}`}
      href={dark.src}
      media="(prefers-color-scheme: dark)"
    />
  )
}

{
  /*
    Using prefers-color-scheme may more optimize.
  */
  images?.map((image) => (
    <link
      rel="prefetch"
      fetchpriority="high"
      as="image"
      type={`image/${image.format}`}
      href={image.src}
      media={image.media}
    />
  ))
}
